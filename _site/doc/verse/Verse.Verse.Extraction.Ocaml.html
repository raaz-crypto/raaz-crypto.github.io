<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>Verse.Verse.Extraction.Ocaml</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library Verse.Verse.Extraction.Ocaml</h1>

<div class="code">

<br/>
</div>

<div class="doc">
<a name="lab34"></a><h1 class="section">Generating the source file.</h1>


<div class="paragraph"> </div>

After the verse program is written and compiled using the appropriate
architecture compiler, we get an object of <span class="inlinecode"><a class="idref" href="Verse.Verse.Language.Pretty.html#Demo.prog"><span class="id" title="definition">prog</span></a></span> of type <span class="inlinecode"><a class="idref" href="Verse.Verse.PrettyPrint.html#Doc"><span class="id" title="inductive">Doc</span></a></span> <span class="inlinecode">+</span>
<span class="inlinecode">{<a class="idref" href="Verse.Verse.Compile.html#Compiler.CompileError"><span class="id" title="inductive">CompileError</span></a>}</span>. We need to get the actual source (C or assembly) out
of this. The recommended way is to extract an ocaml program for
generating the code. We can either extract a ocaml program that prints
the code to its standard output or a program that writes the code into
a given program file.

<div class="paragraph"> </div>

 
<div class="paragraph"> </div>

<a name="lab35"></a><h2 class="section">Printing to standard output</h2>


<div class="paragraph"> </div>

The Coq function given below when extracted will give an ml function that
prints the code to standard output.

<div class="paragraph"> </div>


</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="print_code"><span class="id" title="definition">print_code</span></a> {<span class="id" title="var">E</span> : <span class="id" title="keyword">Prop</span>} (<span class="id" title="var">x</span>: <a class="idref" href="Verse.Verse.PrettyPrint.html#Doc"><span class="id" title="inductive">Doc</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Specif.html#f54393d7670a5aa26d6e138373d42f1c"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Specif.html#f54393d7670a5aa26d6e138373d42f1c"><span class="id" title="notation">{</span></a><a class="idref" href="Verse.Verse.Extraction.Ocaml.html#E"><span class="id" title="variable">E</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Specif.html#f54393d7670a5aa26d6e138373d42f1c"><span class="id" title="notation">}</span></a>)<br/>
&nbsp;&nbsp;:= <a class="idref" href="Verse.Verse.Error.html#recover"><span class="id" title="definition">recover</span></a> (<a class="idref" href="Verse.Verse.Error.html#ap"><span class="id" title="definition">ap</span></a> (<a class="idref" href="Verse.Verse.Extraction.Ocaml.html#print_doc"><span class="id" title="definition">print_doc</span></a>) <a class="idref" href="Verse.Verse.Extraction.Ocaml.html#x"><span class="id" title="variable">x</span></a>).<br/>

<br/>
</div>

<div class="doc">

<div class="paragraph"> </div>

The following code snippet allows extracting an ml program that prints
the source to the standard output.

<div class="paragraph"> </div>

 
<div class="paragraph"> </div>


<div class="paragraph"> </div>

<pre>
Require Import Verse.Extraction.Ocaml.
Definition main : unit := print_code prog.
Extraction "foo.ml" main.
</pre>
 
<div class="paragraph"> </div>


<div class="paragraph"> </div>

Running the program foo.ml will print the program on the standard
output.

<div class="paragraph"> </div>


<div class="paragraph"> </div>

<a name="lab36"></a><h2 class="section">Generating program in a file.</h2>


<div class="paragraph"> </div>

The coq function <span class="inlinecode"><a class="idref" href="Verse.Verse.Extraction.Ocaml.html#writeProgram"><span class="id" title="definition">writeProgram</span></a></span> when extracted gives a ml function
that generates the program in the given file. P The program file
themselves are captured by the inductive type <span class="inlinecode"><a class="idref" href="Verse.Verse.Extraction.Ocaml.html#ProgFile"><span class="id" title="inductive">ProgFile</span></a></span>.

<div class="paragraph"> </div>


</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <a name="ProgFile"><span class="id" title="inductive">ProgFile</span></a> :=<br/>
| <a name="C"><span class="id" title="constructor">C</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Verse.Verse.Extraction.Ocaml.html#ProgFile"><span class="id" title="inductive">ProgFile</span></a>     <br/>
| <a name="ASM"><span class="id" title="constructor">ASM</span></a> : <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Verse.Verse.Extraction.Ocaml.html#ProgFile"><span class="id" title="inductive">ProgFile</span></a>. 
<br/>
<span class="id" title="keyword">Definition</span> <a name="writeProgram"><span class="id" title="definition">writeProgram</span></a> {<span class="id" title="var">E</span> : <span class="id" title="keyword">Prop</span>}(<span class="id" title="var">pf</span> : <a class="idref" href="Verse.Verse.Extraction.Ocaml.html#ProgFile"><span class="id" title="inductive">ProgFile</span></a>) (<span class="id" title="var">prog</span> : <a class="idref" href="Verse.Verse.PrettyPrint.html#Doc"><span class="id" title="inductive">Doc</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Specif.html#f54393d7670a5aa26d6e138373d42f1c"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Specif.html#f54393d7670a5aa26d6e138373d42f1c"><span class="id" title="notation">{</span></a><a class="idref" href="Verse.Verse.Extraction.Ocaml.html#E"><span class="id" title="variable">E</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Specif.html#f54393d7670a5aa26d6e138373d42f1c"><span class="id" title="notation">}</span></a>)<br/>
&nbsp;&nbsp;:= <span class="id" title="keyword">let</span> <span class="id" title="var">filename</span> := <span class="id" title="keyword">match</span> <a class="idref" href="Verse.Verse.Extraction.Ocaml.html#pf"><span class="id" title="variable">pf</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Verse.Verse.Extraction.Ocaml.html#C"><span class="id" title="constructor">C</span></a> <span class="id" title="var">s</span>   ⇒ <span class="id" title="var">s</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Strings.String.html#6c3bece79abbc48868e7371c2d2fa55c"><span class="id" title="notation">++</span></a> ".c"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="Verse.Verse.Extraction.Ocaml.html#ASM"><span class="id" title="constructor">ASM</span></a> <span class="id" title="var">s</span> ⇒ <span class="id" title="var">s</span> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Strings.String.html#6c3bece79abbc48868e7371c2d2fa55c"><span class="id" title="notation">++</span></a> ".s"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>%<span class="id" title="var">string</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">prog_str</span> := <a class="idref" href="Verse.Verse.PrettyPrint.html#layout"><span class="id" title="definition">layout</span></a> <a class="idref" href="Verse.Verse.Error.html#4349a846da865f3ca93aa43a0e297d28"><span class="id" title="notation">&lt;$&gt;</span></a> <a class="idref" href="Verse.Verse.Extraction.Ocaml.html#prog"><span class="id" title="variable">prog</span></a> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">write_it</span> := <a class="idref" href="Verse.Verse.Extraction.Ocaml.html#writefile"><span class="id" title="axiom">writefile</span></a> <a class="idref" href="Verse.Verse.Extraction.Ocaml.html#filename"><span class="id" title="variable">filename</span></a> <a class="idref" href="Verse.Verse.Error.html#4349a846da865f3ca93aa43a0e297d28"><span class="id" title="notation">&lt;$&gt;</span></a> <a class="idref" href="Verse.Verse.Extraction.Ocaml.html#prog_str"><span class="id" title="variable">prog_str</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">in</span> <a class="idref" href="Verse.Verse.Error.html#recover"><span class="id" title="definition">recover</span></a> <a class="idref" href="Verse.Verse.Extraction.Ocaml.html#write_it"><span class="id" title="variable">write_it</span></a>.<br/>

<br/>
</div>

<div class="doc">

<div class="paragraph"> </div>

The following code snippet allows extracting an ml program that saves
the program in the file "foo.c".

<div class="paragraph"> </div>

 
<div class="paragraph"> </div>


<div class="paragraph"> </div>

<pre>
Require Import Verse.Extraction.Ocaml.
Definition main : unit := writeProgram (C "foo") code.
Extraction "foo.ml" main.
</pre>

<div class="paragraph"> </div>

 
<div class="paragraph"> </div>


<div class="paragraph"> </div>

The execution of "foo.ml" will result in generating the "foo.c" file.

<div class="paragraph"> </div>


</div>
<div class="code">
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>